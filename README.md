# RustisDB - 支持 ACID 事务的高性能 Redis-like 存储



![Rust](https://img.shields.io/badge/Rust-1.70+-blue.svg)



![License](https://img.shields.io/badge/License-MIT-green.svg)





RustisDB 是一个用 Rust 重新实现的 Redis-like 键值存储系统，专注于在保持高性能的同时，提供完整的 ACID 事务支持和 MVCC（多版本并发控制）机制。它填补了传统 Redis 在强一致性场景下的不足，适用于对数据可靠性要求极高的业务场景。

## 核心特性

### 🔹 完整 ACID 事务支持

*   **原子性（Atomicity）**：事务中的所有操作要么全部成功，要么全部回滚

*   **一致性（Consistency）**：内置数据校验机制，确保事务执行前后数据状态合法

*   **隔离性（Isolation）**：基于 MVCC 实现多版本隔离，支持读已提交、可重复读等隔离级别

*   **持久性（Durability）**：通过预写日志（WAL）和定期快照确保数据不丢失

### 🔹 高性能与并发控制

*   **多线程架构**：基于分片的无锁并发设计，充分利用多核 CPU 资源

*   **MVCC 多版本控制**：读写操作无冲突，读不加锁，写操作仅创建新版本

*   **高效数据结构**：优化的跳表、哈希表实现，支持 Redis 核心数据类型

*   **低延迟**：微秒级响应时间，在简单事务场景下可达到 10w+ TPS

### 🔹 丰富功能集

*   **Lua 脚本扩展**：内置 Lua 脚本引擎，支持复杂业务逻辑的原子执行

*   **灵活的持久化策略**：可配置的 WAL 刷盘策略，平衡性能与可靠性

*   **完善的监控指标**：内置性能统计和事务指标，便于运维监控

## 架构设计

RustisDB 采用分层架构设计，各组件职责清晰且可独立优化：



```
┌─────────────────────────────────────────────────────────────┐

│  客户端接口层                                              │

│  ├─ 协议解析（RESP 兼容）                                   │

│  ├─ 命令验证与路由                                         │

│  └─ 连接管理与并发控制                                     │

├─────────────────────────────────────────────────────────────┤

│  Lua 脚本引擎层                                            │

│  ├─ 脚本沙箱环境                                           │

│  ├─ Redis 命令绑定                                         │

│  └─ 事务控制 API（commit/rollback）                         │

├─────────────────────────────────────────────────────────────┤

│  事务管理层                                                │

│  ├─ 事务生命周期管理（BEGIN/COMMIT/ROLLBACK）               │

│  ├─ 隔离级别控制                                           │

│  └─ 冲突检测与重试机制                                     │

├─────────────────────────────────────────────────────────────┤

│  并发控制层                                                │

│  ├─ MVCC 多版本管理                                        │

│  ├─ 锁管理器（行级锁/表级锁）                              │

│  └─ 事务调度与优先级控制                                   │

├─────────────────────────────────────────────────────────────┤

│  数据结构引擎                                              │

│  ├─ 核心类型：String/Hash/List/Set/SortedSet               │

│  ├─ 原子操作实现                                           │

│  └─ 索引与查询优化                                         │

├─────────────────────────────────────────────────────────────┤

│  存储引擎层                                                │

│  ├─ 内存表（MemTable）                                      │

│  ├─ 预写日志（WAL）                                         │

│  ├─ 快照管理（Snapshot）                                    │

│  └─ 版本清理与内存回收                                     │

└─────────────────────────────────────────────────────────────┘
```

### 核心技术亮点



1.  **MVCC 实现细节**

*   为每个键的最小修改单元维护版本链

*   读操作通过事务 ID 筛选可见版本，无需加锁

*   写操作创建新版本，不影响旧版本的读取

*   后台线程自动清理无效版本，优化内存占用

1.  **事务回滚机制**

*   基于版本标记的轻量级回滚，无需反向操作

*   未提交版本通过事务状态标记失效

*   回滚操作耗时与事务大小无关（O (1) 复杂度）

*   自动释放锁资源，避免并发阻塞

1.  **多线程分片设计**

*   键空间按哈希分片，每个分片独立线程处理

*   分片内单线程无锁执行，避免上下文切换开销

*   跨分片事务通过分布式事务协调器处理

*   动态负载均衡，根据分片压力调整资源

## 快速开始

### 环境要求

*   Rust 1.70 或更高版本

*   Cargo 包管理器

*   支持 x86\_64 或 ARM64 架构的 Linux/macOS 系统



## Roadmap

核心数据结构与事务支持

MVCC 多版本控制实现

Lua 脚本引擎集成

分布式集群支持

Redis 全命令兼容

动态分片与负载均衡

可视化监控面板

## 贡献指南

我们欢迎任何形式的贡献！如果你想参与项目开发，请：

1.  Fork 本仓库

2.  创建特性分支 (`git checkout -b feature/amazing-feature`)

3.  提交修改 (`git commit -m 'Add some amazing feature'`)

4.  推送到分支 (`git push origin feature/amazing-feature`)

5.  打开 Pull Request

请确保你的代码符合项目的代码风格，并通过所有测试。详细贡献指南请查看 [CONTRIBUTING.md](CONTRIBUTING.md)。

## 许可证

本项目采用 MIT 许可证 - 详见 [LICENSE](LICENSE) 文件。